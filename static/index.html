<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/notosansjp.css">
    <script src="/static/app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      window.onload = (ev) => {
        init();
        render();
      }

      function init() {
        document.getElementById('texts').value = 'swfz,til';
        document.getElementById('tags').value = 'hoge,fuga,piyo';
        document.getElementById('title').value = 'Terminal Image URL Generatorの開発中';
        document.getElementById('bg_color').value = defaultTheme.bgColor;
        document.getElementById('top_color').value = defaultTheme.topColor;
        document.getElementById('top_color1').value = defaultTheme.topColors[0];
        document.getElementById('top_color2').value = defaultTheme.topColors[1];
        document.getElementById('top_color3').value = defaultTheme.topColors[2];
        document.getElementById('top_color4').value = defaultTheme.topColors[3];
        document.getElementById('top_bg_color').value = defaultTheme.topBgColor;
        document.getElementById('top_bg_text').value = '';
        document.getElementById('bottom_color').value = defaultTheme.bottomColor;
        document.getElementById('bottom_color1').value = defaultTheme.bottomColors[0];
        document.getElementById('bottom_color2').value = defaultTheme.bottomColors[1];
        document.getElementById('bottom_color3').value = defaultTheme.bottomColors[2];
        document.getElementById('bottom_color4').value = defaultTheme.bottomColors[3];
        document.getElementById('bottom_bg_color').value = defaultTheme.bottomBgColor;
        document.getElementById('bottom_bg_text').value = 'Tags';
        document.getElementById('title_color').value = defaultTheme.titleColor;
        document.getElementById('command_color').value = defaultTheme.commandColor;
        document.getElementById('prompt_color').value = defaultTheme.promptColor;
        document.getElementById('cursor_color').value = defaultTheme.cursorColor;
      }

      function rmSharp(color) {
        return color.replace('#', '');
      }

      function render() {
        const canvas = document.querySelector('#generator');
        const ctx = canvas.getContext('2d');
        ctx.font = "50pt 'Noto Sans JP'";

        const titleColor = document.querySelector('#title_color').value;
        const topColor = document.querySelector('#top_color').value;
        const topColor1 = document.querySelector('#top_color1').value;
        const topColor2 = document.querySelector('#top_color2').value;
        const topColor3 = document.querySelector('#top_color3').value;
        const topColor4 = document.querySelector('#top_color4').value;
        const topBgColor = document.querySelector('#top_bg_color').value;
        const topBgText = document.querySelector('#top_bg_text').value;
        const bottomColor = document.querySelector('#bottom_color').value;
        const bottomColor1 = document.querySelector('#bottom_color1').value;
        const bottomColor2 = document.querySelector('#bottom_color2').value;
        const bottomColor3 = document.querySelector('#bottom_color3').value;
        const bottomColor4 = document.querySelector('#bottom_color4').value;
        const bottomBgColor = document.querySelector('#bottom_bg_color').value;
        const bottomBgText = document.querySelector('#bottom_bg_text').value;
        const commandColor = document.querySelector('#command_color').value;
        const promptColor = document.querySelector('#prompt_color').value;
        const cursorColor = document.querySelector('#cursor_color').value;
        const bgColor = document.querySelector('#bg_color').value;
        const title = document.querySelector('#title').value;

        const textsInput = document.querySelector('#texts').value;
        const tagsInput = document.querySelector('#tags').value;
        const texts = textsInput !== '' ? textsInput.split(',') : [];
        const tags = tagsInput !== '' ? tagsInput.split(',') : [];

        const topColors = [topColor1, topColor2, topColor3, topColor4];
        const bottomColors = [bottomColor1, bottomColor2, bottomColor3, bottomColor4];

        renderBackground(ctx, bgColor, canvas.width, canvas.height);
        renderTopStatusLine(ctx, texts, topColors, topBgColor, topBgText, topColor);
        renderPrompt(ctx, 10, textLineBase * 2, promptColor);
        renderCommand(ctx, 80, textLineBase * 2, commandColor);
        const titleLines = breakLines(ctx, title, 1150);
        renderTitle(ctx, titleLines, 50, 300, titleColor);
        renderCursor(ctx, titleLines, 50, 100, cursorColor);
        renderBottomStatusLine(ctx, tags, titleLines, bottomColors, bottomBgColor, bottomBgText, bottomColor);

        const topColorsParam = topColors.map((color) => rmSharp(color)).join(',');
        const bottomColorsParam = bottomColors.map((color) => rmSharp(color)).join(',');

        const url = `https://terminal-image.deno.dev/?title=${title}&texts=${texts.join(',')}&tags=${tags.join(',')}&top_color=${rmSharp(topColor)}&top_colors=${topColorsParam}&bottom_color=${rmSharp(bottomColor)}&bottom_colors=${bottomColorsParam}&title_color=${rmSharp(titleColor)}&command_color=${rmSharp(commandColor)}&prompt_color=${rmSharp(promptColor)}&cursor_color=${rmSharp(cursorColor)}&bg_color=${rmSharp(bgColor)}`;
        document.getElementById('url').value = url;
      }

      function copyClipboard() {
        const url = document.getElementById('url');
        url.select();
        document.execCommand('copy');
      }

    </script>
  </head>
  <body>
    <h1 class="m-5 text-gray-800 text-3xl">
      Terminal Image URL Generator
    </h1>
    <div class="border m-5">
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="texts">
            Terminal Texts:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="texts"
              id="texts"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700">
            Top StatusLine Item Background Colors:
          </label>
          <span class="basis-5/6">
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_color1"
              id="top_color1"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_color2"
              id="top_color2"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_color3"
              id="top_color3"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_color4"
              id="top_color4"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="top_bg_color">
            Top StatusLine Background Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_bg_color"
              id="top_bg_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="top_color">
            Top StatusLine Text Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_color"
              id="top_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="top_bg_text">
            Top StatusLine Background Text:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="top_bg_text"
              id="top_bg_text"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="prompt_color">
            Prompt Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="prompt_color"
              id="prompt_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="command_color">
            Command Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="command_color"
              id="command_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="title">
            Title:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="title"
              id="title"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="title_color">
            Title Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="title_color"
              id="title_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="cursor_color">
            Cursor Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="cursor_color"
              id="cursor_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="tags">
            Terminal Texts(Tags):
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="tags"
              placeholder="tags"
              id="tags"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700">
            Bottom StatusLine Item Background Colors:
          </label>
          <span class="basis-5/6">
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_color1"
              id="bottom_color1"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_color2"
              id="bottom_color2"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_color3"
              id="bottom_color3"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_color4"
              id="bottom_color4"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bottom_bg_color">
            Bottom StatusLine Background Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_bg_color"
              id="bottom_bg_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bottom_color">
            Bottom StatusLine Text Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_color"
              id="bottom_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bottom_bg_text">
            Bottom StatusLine Background Text:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="bottom_bg_text"
              id="bottom_bg_text"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bg_color">
            Background Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bg_color"
              id="bg_color"
            />
          </span>
        </div>
      </div>
    </div>
    <div class="m-5">
      <button onClick="copyClipboard()" class="border-gray-400 bg-gray-100 px-2 py-1 text-gray-800 hover:bg-gray-100">Copy</button>
      <input class="border w-full" type="text" id="url" placeholder="terminal image url" readonly/>
    </div>
    <div class="m-5">
      <canvas id="generator" width="1200" height="630" class="center">
      </canvas>
    </div>
  </body>
</html>