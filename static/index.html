<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/notosansjp.css">
    <script src="/static/app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      window.onload = (ev) => {
        init();
        render();
      }

      function init() {
        document.getElementById('title').value = 'Terminal Image URL Generatorの開発中';
        document.getElementById('top_line_texts').value = 'swfz,til';
        document.getElementById('top_line_text_color').value = defaultTheme.topStatusLine.textColor;
        document.getElementById('top_line_item_color1').value = defaultTheme.topStatusLine.itemColors[0];
        document.getElementById('top_line_item_color2').value = defaultTheme.topStatusLine.itemColors[1];
        document.getElementById('top_line_item_color3').value = defaultTheme.topStatusLine.itemColors[2];
        document.getElementById('top_line_item_color4').value = defaultTheme.topStatusLine.itemColors[3];
        document.getElementById('top_line_bg_text').value = '';
        document.getElementById('top_line_bg_color').value = defaultTheme.topStatusLine.bgColor;
        document.getElementById('bg_color').value = defaultTheme.bgColor;
        document.getElementById('prompt_color').value = defaultTheme.promptColor;
        document.getElementById('command_color').value = defaultTheme.commandColor;
        document.getElementById('title_color').value = defaultTheme.titleColor;
        document.getElementById('cursor_color').value = defaultTheme.cursorColor;
        document.getElementById('bottom_line_texts').value = 'hoge,fuga,piyo';
        document.getElementById('bottom_line_text_color').value = defaultTheme.bottomStatusLine.textColor;
        document.getElementById('bottom_line_item_color1').value = defaultTheme.bottomStatusLine.itemColors[0];
        document.getElementById('bottom_line_item_color2').value = defaultTheme.bottomStatusLine.itemColors[1];
        document.getElementById('bottom_line_item_color3').value = defaultTheme.bottomStatusLine.itemColors[2];
        document.getElementById('bottom_line_item_color4').value = defaultTheme.bottomStatusLine.itemColors[3];
        document.getElementById('bottom_line_bg_text').value = 'Tags';
        document.getElementById('bottom_line_bg_color').value = defaultTheme.bottomStatusLine.bgColor;
      }

      function rmSharp(color) {
        return color.replace('#', '');
      }

      function render() {
        const canvas = document.querySelector('#generator');
        const ctx = canvas.getContext('2d');
        ctx.font = "50pt 'Noto Sans JP'";

        const title = document.querySelector('#title').value;
        const topLineTextColor = document.querySelector('#top_line_text_color').value;
        const topLineItemColor1 = document.querySelector('#top_line_item_color1').value;
        const topLineItemColor2 = document.querySelector('#top_line_item_color2').value;
        const topLineItemColor3 = document.querySelector('#top_line_item_color3').value;
        const topLineItemColor4 = document.querySelector('#top_line_item_color4').value;
        const topLineBgText = document.querySelector('#top_line_bg_text').value;
        const topLineBgColor = document.querySelector('#top_line_bg_color').value;
        const bgColor = document.querySelector('#bg_color').value;
        const promptColor = document.querySelector('#prompt_color').value;
        const commandColor = document.querySelector('#command_color').value;
        const titleColor = document.querySelector('#title_color').value;
        const cursorColor = document.querySelector('#cursor_color').value;

        const bottomLineTextColor = document.querySelector('#bottom_line_text_color').value;
        const bottomLineItemColor1 = document.querySelector('#bottom_line_item_color1').value;
        const bottomLineItemColor2 = document.querySelector('#bottom_line_item_color2').value;
        const bottomLineItemColor3 = document.querySelector('#bottom_line_item_color3').value;
        const bottomLineItemColor4 = document.querySelector('#bottom_line_item_color4').value;
        const bottomLineBgText = document.querySelector('#bottom_line_bg_text').value;
        const bottomLineBgColor = document.querySelector('#bottom_line_bg_color').value;

        const topLineTextsInput = document.querySelector('#top_line_texts').value;
        const bottomLineTextsInput = document.querySelector('#bottom_line_texts').value;
        const topLineTexts = topLineTextsInput !== '' ? topLineTextsInput.split(',') : [];
        const bottomLineTexts = bottomLineTextsInput !== '' ? bottomLineTextsInput.split(',') : [];

        const topLineItemColors = [topLineItemColor1, topLineItemColor2, topLineItemColor3, topLineItemColor4];
        const bottomLineItemColors = [bottomLineItemColor1, bottomLineItemColor2, bottomLineItemColor3, bottomLineItemColor4];

        renderBackground(ctx, bgColor, canvas.width, canvas.height);
        renderTopStatusLine(ctx, topLineTexts, topLineItemColors, topLineBgColor, topLineBgText, topLineTextColor);
        renderPrompt(ctx, 10, textLineBase * 2, promptColor);
        renderCommand(ctx, 80, textLineBase * 2, commandColor);
        const titleLines = breakLines(ctx, title, 1150);
        renderTitle(ctx, titleLines, 50, 300, titleColor);
        renderCursor(ctx, titleLines, 50, 100, cursorColor);
        renderBottomStatusLine(ctx, bottomLineTexts, titleLines, bottomLineItemColors, bottomLineBgColor, bottomLineBgText, bottomLineTextColor);

        const topLineItemColorsParam = topLineItemColors.map((color) => rmSharp(color)).join(',');
        const bottomLineItemColorsParam = bottomLineItemColors.map((color) => rmSharp(color)).join(',');

        const url = `https://terminal-image.deno.dev/?title=${title}
&top_line_texts=${topLineTexts.join(',')}
&bottom_line_texts=${bottomLineTexts.join(',')}
&top_line_text_color=${rmSharp(topLineTextColor)}
&top_line_item_colors=${topLineItemColorsParam}
&bottom_line_text_color=${rmSharp(bottomLineTextColor)}
&bottom_line_item_colors=${bottomLineItemColorsParam}
&title_color=${rmSharp(titleColor)}
&command_color=${rmSharp(commandColor)}
&prompt_color=${rmSharp(promptColor)}
&cursor_color=${rmSharp(cursorColor)}
&bg_color=${rmSharp(bgColor)}
&top_line_bg_color=${rmSharp(topLineBgColor)}
&bottom_line_bg_color=${rmSharp(bottomLineBgColor)}
&top_line_bg_text=${topLineBgText}
&bottom_line_bg_text=${bottomLineBgText}
`;

        document.getElementById('url').value = url;
      }

      function copyClipboard() {
        const url = document.getElementById('url');
        url.select();
        document.execCommand('copy');
      }

    </script>
  </head>
  <body>
    <h1 class="m-5 text-gray-800 text-3xl">
      Terminal Image URL Generator
    </h1>
    <div class="border m-5">
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="top_line_texts">
            Terminal Texts:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="top_line_texts"
              id="top_line_texts"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700">
            Top StatusLine Item Background Colors:
          </label>
          <span class="basis-5/6">
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_line_item_color1"
              id="top_line_item_color1"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_line_item_color2"
              id="top_line_item_color2"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_line_item_color3"
              id="top_line_item_color3"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_line_item_color4"
              id="top_line_item_color4"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="top_line_bg_color">
            Top StatusLine Background Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_line_bg_color"
              id="top_line_bg_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="top_line_text_color">
            Top StatusLine Text Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="top_line_text_color"
              id="top_line_text_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="top_line_bg_text">
            Top StatusLine Background Text:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="top_line_bg_text"
              id="top_line_bg_text"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="prompt_color">
            Prompt Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="prompt_color"
              id="prompt_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="command_color">
            Command Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="command_color"
              id="command_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="title">
            Title:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="title"
              id="title"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="title_color">
            Title Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="title_color"
              id="title_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="cursor_color">
            Cursor Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="cursor_color"
              id="cursor_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bottom_line_texts">
            Terminal Texts(Tags):
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="bottom_line_texts"
              placeholder="bottom_line_texts"
              id="bottom_line_texts"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700">
            Bottom StatusLine Item Background Colors:
          </label>
          <span class="basis-5/6">
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_line_item_color1"
              id="bottom_line_item_color1"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_line_item_color2"
              id="bottom_line_item_color2"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_line_item_color3"
              id="bottom_line_item_color3"
            />
            <input
              class="h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_line_item_color4"
              id="bottom_line_item_color4"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bottom_line_bg_color">
            Bottom StatusLine Background Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_line_bg_color"
              id="bottom_line_bg_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bottom_line_text_color">
            Bottom StatusLine Text Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bottom_line_text_color"
              id="bottom_line_text_color"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bottom_line_bg_text">
            Bottom StatusLine Background Text:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="text"
              placeholder="bottom_line_bg_text"
              id="bottom_line_bg_text"
            />
          </span>
        </div>
      </div>
      <div class="flex flex-col space-y-1 odd:bg-gray-100">
        <div class="flex flex-row p-1">
          <label class="ml-2 basis-1/6 font-bold text-gray-700" for="bg_color">
            Background Color:
          </label>
          <span class="basis-2/6">
            <input
              class="block h-6 w-64 appearance-none border border-gray-500 bg-white px-1 py-0 leading-none text-gray-700 focus:outline-none"
              onChange="render()"
              type="color"
              placeholder="bg_color"
              id="bg_color"
            />
          </span>
        </div>
      </div>
    </div>
    <div class="m-5">
      <button onClick="copyClipboard()" class="border-gray-400 bg-gray-100 px-2 py-1 text-gray-800 hover:bg-gray-100">Copy</button>
      <input class="border w-full" type="text" id="url" placeholder="terminal image url" readonly/>
    </div>
    <div class="m-5">
      <canvas id="generator" width="1200" height="630" class="center">
      </canvas>
    </div>
  </body>
</html>